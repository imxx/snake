define(["subsnake","cell","Settings"],function(s,e,t){"use strict";var n={subsnakes:[],head:null,isheadCopying:!1,first:null,last:null,init:function(){var n=new e(t.board.width/2,t.board.height/2),i=new s(n);this.head=n,this.first=i,this.last=i,i.next=i,i.prev=i,i.id=0,this.subsnakes.length=0,this.subsnakes.push(i),this.subsnakesLength=this.subsnakes.length},createNewSubsnake:function(e,t){var n=new s(t);n.prev=e,n.next=this.last,n.id=e.id+1,e.next=n,e.prev=this.first,this.first=n,this.subsnakes.push(n),this.subsnakesLength=this.subsnakes.length},move:function(){this.forEach(function(s){s.move()})},eat:function(){var s=this.last;this.last.addToTheEnd(new e(s.last().x+s.lastXStep,s.last().y+s.lastYStep))},forEach:function(s){for(var e=0;e<this.subsnakesLength;e++)s(this.subsnakes[e],e)},teleportCell:function(s){var e=s.subsnake.cells[s.i]||s.subsnake.first();if(!e.leavingBoard){this.head==e&&(this.isHeadCopying=!0);var t=e.copyToTheMirroredPosition(s.direction);this.first===s.subsnake?(s.subsnake.next.empty()?(s.subsnake.next.addToTheEnd(t),this.first=s.subsnake.next):this.createNewSubsnake(s.subsnake,t),this.head=t,this.isHeadCopying=!1):s.subsnake.next.addToTheEnd(t)}},uncheckEntering:function(s){s.subsnake.cells[s.i].setEntering(!1)},removeCell:function(s){s.subsnake.cells[s.i+1]&&s.subsnake.cells[s.i].copySteps(s.subsnake.cells[s.i+1]),s.subsnake.removeFirst(),s.subsnake.empty()&&(this.last=s.subsnake.next)}};return n});